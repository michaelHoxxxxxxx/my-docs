# SoulBox 计费系统常见问题解答（FAQ）

## 用户常见问题

### 1. 基础计费问题

**Q: SoulBox是如何计费的？**
A: SoulBox采用按使用量计费（Usage-Based Billing）模式：
- 按秒计算资源使用
- 每月订阅费 + 超出额度的使用费
- 透明的费用明细，可随时查看

**Q: 免费版能用多久？**
A: 开发者版（免费版）永久免费，包含：
- 每月$50使用额度（不累计）
- 最多10个并发沙箱
- 5GB存储空间
- 适合个人项目和学习使用

**Q: 使用额度用完了怎么办？**
A: 
- 免费版：需要等到下个月额度重置，或升级到付费版
- 付费版：自动按照超出部分的实际使用量计费
- 可以设置使用上限避免超支

### 2. 价格相关

**Q: 一个典型的开发环境每月要花多少钱？**
A: 以2 vCPU + 4GB RAM的标准环境为例：
- 每天使用8小时：约$34.56/月
- 每天使用4小时：约$17.28/月
- 偶尔使用（每天1小时）：约$4.32/月

**Q: 相比E2B便宜多少？**
A: SoulBox比E2B便宜10-15%：
| 资源 | E2B | SoulBox | 节省 |
|------|-----|---------|------|
| CPU | $0.000014/vCPU/秒 | $0.000012/vCPU/秒 | 14.3% |
| 内存 | $0.0000045/GB/秒 | $0.000004/GB/秒 | 11.1% |

**Q: 有哪些折扣？**
A: 
- 年付折扣：15%（相当于获得2个月免费）
- 两年付折扣：25%
- 批量使用折扣：每月超过$1000部分9折
- 承诺使用折扣：承诺每月$500可获得5%额外折扣

### 3. 订阅管理

**Q: 如何升级/降级订阅？**
A: 
- 在控制台的"订阅管理"页面选择新的订阅级别
- 升级立即生效，按比例计算当月费用
- 降级在下个计费周期生效

**Q: 可以随时取消订阅吗？**
A: 
- 可以随时取消，没有违约金
- 取消后可继续使用到当前计费周期结束
- 数据保留30天，期间可以重新激活

**Q: 如何查看我的使用情况？**
A: 
- 控制台首页显示实时使用量
- "使用报告"页面查看详细历史
- 支持导出CSV格式的详细报告

### 4. 技术问题

**Q: 计费数据多久更新一次？**
A: 
- 资源使用：每2秒收集一次
- 费用计算：实时更新
- 账单生成：每月1日凌晨

**Q: 如何避免意外高额账单？**
A: 
1. 设置使用预算上限
2. 配置超额提醒（80%、100%）
3. 使用自动停止策略
4. 定期检查活跃沙箱

**Q: 网络流量如何计费？**
A: 
- 入站流量：免费
- 出站流量：$0.02/GB
- 内部流量（同区域）：免费

## 开发者问题

### 5. API集成

**Q: 如何通过API获取使用量数据？**
A: 
```bash
# 获取当前使用量
GET /api/v1/billing/usage/current
Authorization: Bearer YOUR_API_KEY

# 获取历史使用量
GET /api/v1/billing/usage/history?start=2025-01-01&end=2025-01-31
```

**Q: 如何设置使用量告警？**
A: 
```javascript
// 使用SDK设置告警
await soulbox.billing.setAlert({
  type: 'usage_limit',
  threshold: 100, // $100
  notification: {
    email: true,
    webhook: 'https://your-webhook.com/alerts'
  }
});
```

**Q: 有使用量预估API吗？**
A: 
```javascript
// 预估成本
const estimate = await soulbox.billing.estimateCost({
  vcpu: 2,
  memory_gb: 4,
  hours_per_day: 8,
  days: 30
});
// 返回: { monthly_cost: 34.56, breakdown: {...} }
```

### 6. 计费事件

**Q: 支持哪些Webhook事件？**
A: 
- `usage.limit.reached` - 达到使用限制
- `invoice.created` - 账单创建
- `invoice.paid` - 支付成功
- `invoice.payment_failed` - 支付失败
- `subscription.updated` - 订阅变更

**Q: 如何处理支付失败？**
A: 
1. 系统自动重试3次（第1、3、5天）
2. 发送邮件通知
3. 7天后暂停服务（数据保留）
4. 30天后删除数据

### 7. 企业功能

**Q: 如何实现成本分配？**
A: 
- 使用标签（tags）标记资源
- 按项目/部门生成分组报告
- 支持成本中心映射
- 可导出到财务系统

**Q: 支持预付费吗？**
A: 
- 支持预充值（最少$500）
- 预付费享受额外3%折扣
- 余额不足时自动从绑定支付方式扣费

**Q: 可以开发票吗？**
A: 
- 自动生成电子发票
- 支持增值税发票（需要提供税务信息）
- 可以设置发票抬头和地址

## 故障排除

### 8. 常见问题

**Q: 为什么我的使用量突然增加？**
A: 可能原因：
1. 忘记关闭的沙箱
2. 死循环或资源泄漏
3. 被恶意使用（检查API密钥）

解决方法：
- 检查活跃沙箱列表
- 查看详细使用日志
- 启用异常检测告警

**Q: 账单金额与预期不符？**
A: 
1. 检查是否有未关闭的沙箱
2. 查看详细使用明细
3. 确认折扣是否正确应用
4. 联系支持团队审核

**Q: 支付失败怎么办？**
A: 
1. 检查支付方式是否有效
2. 确认信用卡额度
3. 更新支付信息
4. 手动重试支付

### 9. 安全相关

**Q: 如何防止API密钥被滥用？**
A: 
- 定期轮换API密钥
- 设置IP白名单
- 启用使用量限制
- 监控异常使用模式

**Q: 计费数据的准确性如何保证？**
A: 
- 每个计量点都有唯一ID防止重复
- 使用事务保证数据一致性
- 定期审计和对账
- 保留90天原始数据供核查

### 10. 迁移相关

**Q: 从E2B迁移有什么优惠？**
A: 
- 前3个月50%折扣
- 额外$200使用额度
- 免费迁移支持
- API完全兼容，无需改代码

**Q: 如何迁移历史数据？**
A: 
```bash
# 使用迁移工具
soulbox migrate from-e2b \
  --e2b-api-key=xxx \
  --include-history \
  --preserve-ids
```

**Q: 迁移期间服务会中断吗？**
A: 
- 支持零停机迁移
- 可以并行运行新旧系统
- 逐步切换流量
- 提供回滚方案

## 最佳实践

### 11. 成本优化建议

1. **合理设置资源规格**
   - 开发环境：1 vCPU + 1GB RAM
   - 测试环境：2 vCPU + 2GB RAM
   - 生产环境：按需配置

2. **使用自动关闭策略**
   ```javascript
   // 闲置30分钟自动关闭
   sandbox.setIdleTimeout(30 * 60 * 1000);
   ```

3. **批量操作优化**
   - 合并多个小任务
   - 使用队列避免并发高峰
   - 预热常用环境

4. **监控和预警**
   - 设置日预算限制
   - 启用异常使用检测
   - 定期审查使用报告

### 12. 联系支持

**Q: 如何联系计费支持？**
A: 
- 邮箱：billing@soulbox.dev
- 工作时间在线客服（Pro版以上）
- 紧急热线：+86 400-XXX-XXXX（企业版）

**Q: 响应时间是多久？**
A: 
- 开发者版：48小时（社区支持）
- 专业版：12小时（工作时间）
- 团队版：4小时
- 企业版：1小时（24/7）

---

*最后更新：2025-01-07*  
*版本：1.0*

如有其他问题，请访问 [完整文档](soulbox_billing_system_design.md) 或联系支持团队。